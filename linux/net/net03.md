# 0x00. 导读

# 0x01. 简介
数据: Packet Package

FIB：全称是(Forwarding Information Base)，翻译过来就是转发信息表。FIB是内核skb路由过程的数据库，或者说内核会将路由翻译成FIB中的表项。我们习惯说的查询路由，对于内核来说，应该叫查询FIB。

当 Linux 从网卡收到报文时会查询路由( fib )，路由决定了报文是应该转发 ( forward )还是上送本机 ( local deliever )。

# 0x02. 

网络层中涉及众多的协议，其中包括最重要的协议，也是 TCP/IP 的核心协议—— IP 协议。
IP协议非常简单，仅仅提供不可靠、无连接的传送服务。与IP协议配套使用实现其功能的还有地址解析协议ARP、逆地址解析协议RARP、因特网报文协议ICMP、因特网组管理协议IGMP。

网络层负责对子网间的数据包进行路由选择。

重要的设备：路由器。

## ICMP

网际控制报文协议（Internet Control Message Protocol），可以报告错误信息或者异常情况，ICMP报文封装在IP数据报当中。

ICMP协议的应用：

Ping应用：网络故障的排查；

Traceroute应用：可以探测IP数据报在网络中走过的路径。

## 

网络接口上并不是一定都有IP地址，比如veth0和veth1后面都没有IP地址。

IP地址是网络层的概念，而网卡其实更多的是链路层的概念。

一个简化版的IP报文的接收处理流程如下：
```
IF  报文目标MAC == 网卡MAC
    对报文进行路由
	IF 报文目标IP匹配本机路由
        上送本机传输层
	ELSE IF 匹配其他路由
		根据路由进行转发
	END
END
```
在这个过程中，网卡只参加了链路层头部的检查，只要报文通过检查，就会上送给网络层进行路由，至于之后报文去哪，它才不会管。报文去哪儿完全是路由说了算！

一般来说就两条路，如果匹配上了本机路由，则表示这个报文就是给自己的，那么就根据报文的 protocol 字段，上送给对应协议(比如TCP UDP ICMP)处理；
如果匹配上其他路由,就表示这个报文只是将本机当作中转站，于是它会根据路由结果找到报文的出网络接口，从该网络接口(管道)的另一端发送出去.

那么问题来了，这些路由是哪里来的？

答案是：当你为网络接口配置IP地址时，内核会生成对应的主机路由、网段路由和广播路由！