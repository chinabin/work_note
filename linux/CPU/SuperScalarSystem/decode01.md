# 0x00. 导读

# 0x01. 简介

**在流水线中，指令解码(decode)阶段的任务是将指令中携带的信息提取出来，处理器使用这些信息控制后续的流水线来执行这条指令**。

指令集的复杂程度直接决定了这部分任务的工作量，对于 CISC 指令集，例如 x86 来说，指令的长度是不固定的，解码阶段首先需要分辨指令的边界，这样才能够找到有效的指令，而且x86指令的寻址方式也很复杂，这也增加了解码的难度。而对于RISC指令集来说，指令的长度是固定的，例如MIPS指令和ARM指令的长度都是32位，这样很容易将指令分辨出来，而且RISC处理器的寻址方式相对也是比较简单的，这些因素都导致RISC处理器的解码难度要远低于CISC处理器，因此RISC处理器在成本和功耗方面天生就比CISC处理器占据优势。

影响处理器解码复杂度的还有一个因素，那就是每周期可以解码的指令个数，由于每条指令都需要一个完整的解码电路。所以对于一个每周期可以解码 n 条指令的超标量处理器来说，就需要 n 个解码电路，这样当然也就增加了解码电路的复杂度。

有些特殊指令也需要在解码阶段将其转换为普通的指令，方便后面的流水线按照一般指令的处理方式来执行它们。

# 0x02. 指令缓存

在前文说过，为了减少 I-Cache 缺失带来的影响，处理器可以在取指令阶段从 I-Cache 中取出的指令个数多于每周期可以解码的指令个数，这就需要在取指令阶段和解码阶段之间加入一个缓存，用来将 I-Cache 取出的所有指令保存起来，这个缓存称为 **指令缓存(instruction buffer)**，加人这个缓存之后，取指令阶段最终会输出两个主要的部分给这个缓存(假设每周期可以从 I-Cache 中取出四条指令，每周期只能解码两条指令)。
- (1) 四条指令，当然这四条指令未必全部都是有效的;
- (2) 有效指令的个数。

指令缓存是超标量处理器中必需的部件，其原因有如下两个。
- (1) 在很多超标量处理器中，每周期可以取指令的个数大于每周期可以解码指令的个数，这样即使在 I-Cache 缺失的时候，指令缓存中也仍然有存有一些余量的指令，如果 I-Cache 的缺失可以很快地解决，那么基本上就不会引起流水线的暂停，这样就可以增加处理器的性能。
- (2) 在超标量处理器中，即使每周期取指令的个数等于每周期解码指令的个数，在流水线的解码阶段却有一些特殊的指令要处理，这会导致取指令阶段得到的所有指令没有办法在解码阶段全部都得到处理。所以还是需要一个地方能缓存指令。