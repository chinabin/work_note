# 一、简介

性能工具有系统级别和进程级别，有基于计数器、跟踪、剖析(profiling)。

## 1.1 计数器

内核维护了各种统计数据，成为计数器，用于对事件计数。

计数器的使用可以认为是 零开销 的，因为它们默认就是开启的，而且由内核维护，唯一的使用开销就是从用户空间读取（可以忽略不计）。

系统级别：
- vmstat: 虚拟内存和物理内存的统计
- mpstat: 每个 CPU 的使用情况
- iostat: 每个磁盘 I/O 的使用情况，由块设备接口报告。
- netstat: 网络接口的统计，TCP/IP 栈的统计，以及每个连接的一些统计信息。
- sar: 各种各样的统计，能归档历史数据。

这些工具有哦一个使用惯例，即可选时间间隔和次数。

进程级别:
- ps: 进程状态，显示进程的各种统计信息，包括内存和 CPU 的使用
- top: 按一个统计数据(如 CPU 使用)排序，显示排名高的进程
- pmap: 将进程的内存段和使用统计一起列出。

这些工具一般是从 /proc 文件系统里读取统计信息的。


## 1.2 跟踪

跟踪收集每一个事件的数据以供分析。跟踪框架一般默认是不启用，因为跟踪捕获数据会有 CPU 开销，并且需要存储空间存放。

日志，包括系统日志，可以认为是一种默认开启的低频率跟踪。

系统级别:
- tcpdump: 网络包跟踪(用 libpcap 库)
- blktrace:块 I/O 跟踪
- DTrace: 跟踪内核的内部活动和所有资源的使用，支持静态和动态的跟踪。
- SystemTap: 同上。
- perf: Linux 性能事件，跟踪静态和动态的探针。
- iosnoop: 块 I/O 跟踪，基于 DTrace 
- execsnoop: 跟踪新进程，基于 DTrace

DTrace 和 SystemTap 都是可编程环境，在它们之上可以构建系统级别的跟踪工具。

进程级别:
- strace: 基于 Linux 系统的系统调用跟踪
- gdb: 源代码级别的调试器


## 1.3 剖析

通过对目标收集采样和快照来归纳目标特征。

系统级别:
- oprofile: Linux 系统剖析
- perf: Linux 性能工具集，包含有剖析的子命令
- DTrace: 程序化剖析，基于时间的剖析用自身的 profile provider ，基于硬件事件的剖析用 cpc provider
- SystemTap: 程序化剖析
- cachegrind: 源自 valgrind 工具集，能对硬件缓存的使用做剖析

## 1.4 监视

sar 是基于计数器，在预定的时间(通过 cron )执行以记录系统计数器的状态。sar 是通过 sysstat 包提供的，很多第三方监视产品基于 sar 。
