# 0x00. 导读

# 0x01. 简介

NTP（Network Time Protocol，网络时间协议）是用来使网络中的各个计算机时间同步的一种协议。它的用途是把计算机的时钟同步到世界协调时UTC，其精度在局域网内可达0.1ms，在互联网上绝大多数的地方其精度可以达到1-50ms。NTP服务器就是利用NTP协议提供时间同步服务的。

NTP客户端可以定时自动向NTP服务器发送请求来获取时间，NTP服务器将时间发送给客户端。

**不同机器间同步时间，可以使用 ntpdate 命令（立即同步），也可以使用 ntpd 服务（缓慢同步）。**

**注意1**：如果 ntpd 服务已经启动，端口会被 ntpd 服务端占用，此时 ntpdate 命令就不能手动同步时间了。  

**注意2**：这样的同步，只是强制性的将系统时间与ntp服务器时间同步，机器的硬件时间不会同步，如果希望硬件时间和同步完的系统时间一直，可以通过 hwclock -w 将硬件时间与系统时间同步。

# 0x02. ntpdate

```bash
# ntpdate [NTP IP/hostname]
$ ntpdate 192.168.0.1
$ ntpdate time.ntp.org
```

# 0x03. ntpd

使用 ntpd 服务，要好于 ntpdate 加 cron 的组合。因为 ntpdate 同步时间会造成时间的突变和跳跃，对一些依赖时间的程序和服务会造成影响。比如 sleep，timer 等。而且 ntpd 服务可以在修正时间的同时，修正 CPU Tick。因此理想的做法为，在开机的时候，使用 ntpdate 强制同步时间，在其他时候使用 ntpd 服务来同步时间。

要注意的是，ntpd 有一个自我保护的机制：如果本机与上源时间相差太大，ntpd 不会运行时间同步操作，所以新设置的时间服务器一定要先 ntpdate 从上源取得时间初值, 然后启动 ntpd服务。ntpd服务运行后，先是每64秒与上源NTP服务器同步一次，根据每次同步时测得的误差值经复杂计算逐步调整自己的时间，随着误差减小，逐步增加同步的间隔。每次跳动，都会重复这个调整的过程。